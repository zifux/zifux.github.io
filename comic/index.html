<!DOCTYPE html>
<html>
    <head>
        <title>动漫狂阅读器.4</title>
    </head>
    <body>
        <div align="center">
            <div id="info">加载中...</div>
            <a href="#" id="next" align="center">
            
                <img id="show" src="">

            </a><br/>
            <div style="position:fixed;bottom:20px;left:20px">
                <input type="checkbox" id="noScroll" checked/>不滚动
            </div>
            
            <a href="#" id="nextSe">下一章</a>
            <form action="" method="get">
                漫画ID<input type="text" name="mg">
                <input type="submit">
            </form>
            <a href="http://www.cartoonmad.com" target="_blank">动漫狂网站</a>
        </div>
        <img id="buf1" src="" style="display:none">
        <img id="buf2" src="" style="display:none">
        <img id="buf3" src="" style="display:none">
    </body>
    <script>
        (function(window,document){
        var stop=false;
        var scrollVal=null
        var scrollElem=document.getElementById("noScroll");
        scrollElem.onclick=updateState
        var pa={};
        var pas=document.location.search.substring(1).split("&");
        for(var p in pas){
            var tmp=pas[p].split("=");
            pa[tmp[0]]=tmp[1];
        }
        var url="http://web3.cartoonmad.com/c86ns736r62/";
        var nowPic=1;
        var nowSe=1;
        var nowMg=1698;
        var viewHistory=null;
        var mgHistory={};
        if(window.localStorage.h!=null){
            viewHistory=window.localStorage.h.split(",");
        }
        if(window.localStorage.noScroll===undefined){
            window.localStorage.noScroll=scrollElem.checked;
        }
        scrollElem.checked=window.localStorage.noScroll=="true";
        if(pa["mg"]!=null){
            nowMg=pa["mg"]
        }else if(history!=null){
            nowMg=viewHistory[0]
        }
        nowMg=parseInt(nowMg)
        if(pa["se"]!=null){
            nowSe=pa["se"]
        }else if(history!=null){
            nowSe=viewHistory[1]
        }
        nowSe=parseInt(nowSe)
        if(pa["pic"]!=null){
            nowPic=pa["pic"]
        }else if(history!=null){
            nowPic=viewHistory[2]
        }
        nowPic=parseInt(nowPic);
        if(window.localStorage.mgHistory!=null){
            mgHistory=JSON.parse(window.localStorage.mgHistory);
            var have=false;
            for(var i in mgHistory){
                if(i==nowMg){
                    have=true;
                    break;
                }
            }
            if(!have){
                mgHistory[nowMg]=""
            }
            showMgHistory(mgHistory);
        }else{
            mgHistory[nowMg]=""
        }
        window.localStorage.clear()
        window.localStorage.h=[nowMg,nowSe,nowPic].join(",")
        window.localStorage.mgHistory=JSON.stringify(mgHistory)
        window.localStorage.noScroll=scrollElem.checked;
        document.title="第"+nowSe+"章-漫画"+nowMg;
        function To3(num){
            if(num<10){
                return "00"+num;
            }else if(num<100){
                return "0"+num;
            }else{
                return ""+num;
            }
        }
        function updateState(){
            window.localStorage.noScroll=scrollElem.checked;
            console.log(window.localStorage.noScroll);
            if(scrollElem.checked&&scrollVal!=null){
                clearInterval(scrollVal);
                clearTimeout(scrollVal);
            }
        }
        function showMgHistory(mgh){

        }
        //http://img.cartoonmad.com/ctimg/5356.jpg
        var show=document.getElementById("show");
        var buf1=document.getElementById("buf1");
        var buf2=document.getElementById("buf2")
        var buf3=document.getElementById("buf3");
        show.src=url+nowMg+"/"+To3(nowSe)+"/"+To3(nowPic)+".jpg";

        document.getElementById("next").href=document.location.pathname+"?mg="+nowMg+"&se="+nowSe+"&pic="+(nowPic+1);
        document.getElementById("nextSe").href=document.location.pathname+"?mg="+nowMg+"&se="+(nowSe+1)+"&pic=1";

        buf1.src=url+nowMg+"/"+To3(nowSe)+"/"+To3(nowPic+1)+".jpg";
        buf2.src=url+nowMg+"/"+To3(nowSe)+"/"+To3(nowPic+3)+".jpg";
        buf3.src=url+nowMg+"/"+To3(nowSe)+"/"+To3(nowPic+5)+".jpg";
        show.onload=function(){
            if(show.naturalWidth<window.innerWidth*0.62){
                show.width=window.innerWidth*0.62
            }else if(show.naturalWidth>window.innerWidth-40){
                show.width=window.innerWidth-40
            }
            document.getElementById("info").innerHTML=""
        }
        show.onerror=function(){
            if(pa["pic"]==1){
                document.getElementById("info").innerHTML="已经没有了"
                stop=true;
            }else{
                window.location.href=document.location.pathname+"?mg="+nowMg+"&se="+(nowSe+1)+"&pic=1";
            }
        }
        buf1.onerror=function(){
            if(!stop)
            buf1.src=url+nowMg+"/"+To3(nowSe+1)+"/"+To3(1)+".jpg";
        }
        buf2.onerror=function(){
            if(!stop)
            buf2.src=url+nowMg+"/"+To3(nowSe+1)+"/"+To3(2)+".jpg";
        }
        buf3.onerror=function(){
            if(!stop)
            buf3.src=url+nowMg+"/"+To3(nowSe+1)+"/"+To3(3)+".jpg";
        }
        var WinTop=0;
        if(!scrollElem.checked){
            scrollVal=setTimeout(function(){
                scrollVal=setInterval(function(){
                    WinTop+=1;
                    window.scroll(0,WinTop);
                    if(document.body.scrollTop<WinTop){
                        clearInterval(scrollVal);
                        scrollVal=setTimeout(function(){
                            window.location.href=document.location.pathname+"?mg="+nowMg+"&se="+nowSe+"&pic="+(nowPic+1);
                        },5000);
                    }
                },25);
            },5000);
        }
        
    })(window,document)
    </script>
</html>