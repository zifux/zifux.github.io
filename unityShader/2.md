##预备知识

## 名词
- 着色器(Shader):Shader是一段在GPU中运行的程序,用于命令GPU如何渲染物体,包括顶点着色器,片元着色器等.
- GPU流水线:类似于工厂流水线,CPU流水线,是一种提高GPU运行效率的技术.
- 顶点着色器(Vertex Shader):是一段程序,用于控制顶点的位置与颜色等.
- 顶点:在空间中的一个点,一般模型由许多点以及点构成的片元组成.
- 图元:由顶点组成的点,线或多边形.
- 视野:摄像机能看到的空间.
- 片元:图元经过转换后组成片元,每个片元对应一个像素.
- 片元着色器(Fragment Shader):一段程序,用于控制片元中许多像素的颜色等.
# GPU流水线与着色器
## GPU流水线
GPU流水线用于提高GPU运行效率,不是在上一个渲染结束后进行下一个渲染,而且分步骤同时渲染多个,不过每个渲染都处在不同的流水线阶段,这样可以充分利用GPU.一般GPU流水线有以下两个阶段.
### 几何阶段
这个阶段着重于渲染物体的形状,对原始的模型顶点和颜色按需调整.它分为几个部分.
#### 顶点着色器
VertexShader 顶点着色器是完全可编程的部分,在其中进行顶点空间变换,顶点着色等操作.它的输入来自CPU,准确的说是来自显存中的模型数据,这些数据来自CPU的DrawCall.一般UnityShader使用这个着色器修改模型形状,例如使平面出现波浪模拟水面.
#### 曲面细分着色器
TessellationShader 这是一个可选部分,用于细分图元,例如使用法线贴图在边缘会产生漏洞,使用曲面细分就可以使得边缘也有凹凸感.一般在Unity中的Surface Shader里使用这个着色器.在VFShader中也可以使用但比较麻烦.
#### 几何着色器
GeometryShader 可选着色器,用于逐个图元的着色操作,或是产生更多图元.
#### 裁剪
不可编程可配置,用于裁剪那些一半在视野外,一半在视野内的图元.虽然不可编程但有灵活的配置项控制.
#### 屏幕映射
不可编程不可配置,它将图元转换到屏幕空间中,但不对z轴做处理,与其共同构成窗口空间,为光栅化做准备.
### 光栅化阶段
这个阶段开始就是在屏幕空间中计算,基本每一次计算对应了屏幕的一个或多个像素.
#### 三角形设置 三角形遍历
这两个阶段是不可编程不可配置的.上一阶段只得到了三角形顶点信息,三角形设置是为了计算整个三角形对像素的覆盖情况.三角形遍历是遍历那些被三角形网格覆盖的像素,并对网格内的像素进行插值,最后对每个像素生成一个对应的片元.
#### 片元着色器
片元着色器是一个重要的着色器,完全可编程,用于实现逐个片元的着色操作,一个片元的着色结果就是一个像素,在实际编程中也是返回一个RGBA的浮点数据,但这里的数据不是直接显示在屏幕上,而且存放在片元中,在最后一个阶段才被渲染到屏幕上.
#### 逐片元操作
不可编程可配置,这个阶段负责许多重要操作,例如模板测试,深度测试,透明测试,修改颜色,深度缓冲,混合等.